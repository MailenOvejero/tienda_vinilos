<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Carrito - Ondas Negras</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <img src="img/logo_tienda.png" alt="Logo" class="logo" />
  </header>

  <main class="carritoPage">
    <h2 class="tituloSeccion">üõí Mi Carrito</h2>

    <!-- Btn volver -->
    <div class="volverContenedor">
      <a href="index.html" class="btnVolver">‚¨Ö Volver</a>
    </div>

    <!-- listado d productos -->
    <div id="listadoCarrito" class="tarjetasFull"></div>

    <!-- Total $$ -->
    <div id="totalCarrito"></div>

    <!-- formulario de pago -->
    <section class="formPago">
      <h2 class="tituloSeccion">üí≥ Pago con Tarjeta</h2>
      <form id="pagoForm" novalidate>
        <div class="grupoForm">
          <label for="nombreTitular">Nombre del titular</label>
          <input type="text" id="nombreTitular" required>
        </div>

        <div class="grupoForm">
          <label for="numeroTarjeta">N√∫mero de tarjeta</label>
          <input type="text" id="numeroTarjeta" maxlength="16" required>
          <div class="tarjetasIconos">
            <img src="https://img.icons8.com/color/48/000000/visa.png" alt="Visa">
            <img src="https://img.icons8.com/color/48/000000/mastercard.png" alt="MasterCard">
            <img src="https://img.icons8.com/color/48/000000/amex.png" alt="Amex">
          </div>
        </div>

        <div class="grupoForm fila">
          <div>
            <label for="expiracion">Expiraci√≥n (MM/AA)</label>
            <input type="text" id="expiracion" maxlength="5" placeholder="MM/AA" required>
          </div>
          <div>
            <label for="cvv">CVV</label>
            <input type="text" id="cvv" maxlength="4" required>
          </div>
        </div>

        <div class="grupoForm">
          <label for="email">Email de contacto</label>
          <input type="email" id="email" required>
        </div>

        <button type="submit" class="btnCarrito">Confirmar Pago</button>
      </form>
    </section>
  </main>

  <script>
    // ======================
    //PRODUCTOS DEL CARRITO CON SU TOTALL
    // ======================
    document.addEventListener("DOMContentLoaded", () => {
      const listado = document.getElementById("listadoCarrito");
      const totalDiv = document.getElementById("totalCarrito");
      let carrito = JSON.parse(localStorage.getItem("carrito")) || [];

      if (carrito.length === 0) {
        listado.innerHTML = "<p>No hay vinilos en el carrito.</p>";
        totalDiv.innerHTML = "";
        return;
      }

      let total = 0;

      carrito.forEach((v, index) => {
        total += parseFloat(v.precio);

        const tarjeta = document.createElement("div");
        tarjeta.classList.add("tarjeta");
        tarjeta.innerHTML = `
          <h3>${v.nombre}</h3>
          <p><strong>$${v.precio}</strong></p>
          <button onclick="eliminarDelCarrito(${index})">Eliminar</button>
        `;
        listado.appendChild(tarjeta);
      });

      totalDiv.innerHTML = `<strong>Total a pagar: $${total}</strong>`;
    });

    function eliminarDelCarrito(index) {
      let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      carrito.splice(index, 1);
      localStorage.setItem("carrito", JSON.stringify(carrito));
      location.reload();
    }

    // ======================
    // Mini validaciones del pago
    // ======================
    document.getElementById("pagoForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const numeroTarjeta = document.getElementById("numeroTarjeta").value;
      const expiracion = document.getElementById("expiracion").value;
      const cvv = document.getElementById("cvv").value;

      if (!/^\d{16}$/.test(numeroTarjeta)) {
        alert("N√∫mero de tarjeta inv√°lido (16 d√≠gitos num√©ricos)");
        return;
      }

      if (!/^(0[1-9]|1[0-2])\/\d{2}$/.test(expiracion)) {
        alert("Fecha de expiraci√≥n inv√°lida (MM/AA)");
        return;
      }

      if (!/^\d{3,4}$/.test(cvv)) {
        alert("CVV inv√°lido (3 o 4 d√≠gitos num√©ricos)");
        return;
      }

      alert(" Pago realizado con √©xito. ¬°Gracias por tu compra!");
      localStorage.removeItem("carrito");
      window.location.href = "index.html";
    });
  </script>
</body>
</html>
